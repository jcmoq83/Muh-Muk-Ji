<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ë­ë¨¹ì§€</title>
  <meta name="description" content="ë©”ë‰´ í† ë„ˆë¨¼íŠ¸ë¡œ ì˜¤ëŠ˜ì˜ í•œ ë¼ë¥¼ ê²°ì •í•˜ì„¸ìš”. ìµœì¢… ë©”ë‰´ëŠ” ë„¤ì´ë²„ì§€ë„/ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ë°”ë¡œ ê²€ìƒ‰!" />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Fredoka:wght@400;600;700&family=Noto+Sans+KR:wght@400;600;700&family=Press+Start+2P&display=swap");
    :root{
      --bg:#0b1020;
      --card:#0f172a;
      --card2:#111827;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line:#1f2937;
      --accent:#7c5cff;
      --accent2:#22d3ee;
      --danger:#ff4d6d;
      --ok:#2dd4bf;
      --shadow: 0 22px 46px rgba(0,0,0,.45);
      --radius: 20px;
      --glow: 0 0 22px rgba(124,92,255,.35);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: "Fredoka","Noto Sans KR",sans-serif;
      background:
        radial-gradient(900px 600px at 15% 0%, rgba(124,92,255,.25), transparent 60%),
        radial-gradient(700px 500px at 90% 10%, rgba(34,211,238,.22), transparent 55%),
        radial-gradient(900px 700px at 60% 100%, rgba(255,77,109,.18), transparent 60%),
        linear-gradient(180deg, rgba(8,12,24,.9), rgba(10,16,32,.95)),
        var(--bg);
      background-blend-mode: screen, screen, screen, normal, normal;
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 6vh 0 8vh;
    }
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image:
        linear-gradient(rgba(255,255,255,.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.04) 1px, transparent 1px);
      background-size: 48px 48px;
      opacity:.35;
      mix-blend-mode: soft-light;
    }
    a{ color:inherit; }
    .wrap{
      width:min(980px, 100%);
      padding: 54px 18px 68px;
    }
    header{
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:22px;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(34,211,238,.95));
      box-shadow: 0 0 0 2px rgba(255,255,255,.06), 0 12px 24px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.45), transparent 55%);
      transform: rotate(20deg);
    }
    h1{
      font-family: "Bebas Neue","Fredoka","Noto Sans KR",sans-serif;
      font-size: 40px;
      margin:0 0 4px;
      letter-spacing: .6px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      line-height:1.6;
      font-size: 16px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 14px;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 999px;
      background: rgba(12,16,30,.7);
      backdrop-filter: blur(12px);
      color: var(--muted);
      font-size: 12.5px;
      user-select:none;
      white-space:nowrap;
      box-shadow: 0 10px 20px rgba(0,0,0,.35);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
    }
    @media (max-width: 880px){
      .grid{ grid-template-columns: 1fr; }
      header{ flex-direction:column; align-items:stretch; }
      .pill{ justify-content:center; }
    }
    .card{
      background: linear-gradient(180deg, rgba(15,23,42,.92), rgba(8,12,24,.9));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .inner{ padding:16px; }
    .section-title{
      margin:0 0 10px;
      font-size: 15px;
      letter-spacing:-.2px;
      color: #e2e8f0;
    }
    .muted{ color:var(--muted); }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .row.space{ justify-content:space-between; }
    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      padding: 11px 12px;
      border-radius: 14px;
      background: rgba(12,16,30,.85);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 10px 22px rgba(0,0,0,.25);
      transition: transform .06s ease, background .15s ease, border-color .15s ease, box-shadow .2s ease;
      user-select:none;
      touch-action: manipulation;
    }
    .btn:hover{
      background: rgba(20,26,44,.95);
      box-shadow: 0 12px 26px rgba(0,0,0,.35);
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(34,211,238,.95));
      border-color: rgba(124,92,255,.5);
      color:#0b1020;
      text-shadow: 0 1px 0 rgba(255,255,255,.2);
    }
    .btn.primary:hover{ filter: brightness(1.06); }
    .btn.ghost{
      background: rgba(12,16,30,.55);
      border-color: rgba(255,255,255,.14);
    }
    .btn.danger{
      background: rgba(255,77,109,.12);
      border-color: rgba(255,77,109,.35);
    }
    .btn.ok{
      background: rgba(45,212,191,.15);
      border-color: rgba(45,212,191,.35);
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
    }
    .chip{
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(12,16,30,.7);
      color: var(--muted);
      font-size: 12px;
    }
    #roundChip,
    #matchChip{
      font-family: "Press Start 2P", "Bebas Neue", "Fredoka", "Noto Sans KR", sans-serif;
      font-size: 10px;
      letter-spacing: 1px;
      color: #0b1020;
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(34,211,238,.95));
      border-color: rgba(34,211,238,.6);
      text-shadow: 0 1px 0 rgba(255,255,255,.2);
    }
    .hr{ height:1px; background: rgba(255,255,255,.08); margin: 12px 0; }

    /* Setup controls */
    .range-wrap{
      display:grid;
      grid-template-columns: 1fr 120px;
      gap:10px;
      align-items:center;
      margin-top:10px;
    }
    input[type="range"]{ width:100%; }
    input[type="number"]{
      width:100%;
      padding: 11px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(12,16,30,.85);
      color: var(--text);
      outline:none;
    }
    details{
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.08);
      background: rgba(12,16,30,.55);
      overflow:hidden;
    }
    summary{
      padding: 12px 14px;
      cursor:pointer;
      user-select:none;
      color:#dbeafe;
      font-size: 13.5px;
      list-style:none;
    }
    summary::-webkit-details-marker{ display:none; }
    .details-inner{ padding: 0 14px 14px; color: var(--muted); }
    textarea{
      width:100%;
      min-height: 160px;
      padding: 12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(12,16,30,.85);
      color: var(--text);
      outline:none;
      resize: vertical;
      line-height:1.5;
      font-size: 13px;
    }
    .hint{ font-size:12px; color:var(--muted); line-height:1.4; margin-top:8px; }

    body.state-play header,
    body.state-play aside{
      display:none;
    }
    body.state-play .grid{
      grid-template-columns: 1fr;
    }
    body.state-play #mainCard{
      width:100%;
    }
    body.state-result aside{
      display:none;
    }
    body.state-result .grid{
      grid-template-columns: 1fr;
    }

    /* Tournament */
    .arena{
      display:grid;
      grid-template-columns: 1fr 120px 1fr;
      gap: 12px;
      padding: 14px;
      align-items:stretch;
    }
    @media (max-width: 880px){
      .arena{
        grid-template-columns: 1fr;
      }
      .vs{
        display:none;
      }
    }
    .pick{
      display:flex;
      flex-direction:column;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(18,24,42,.95), rgba(9,12,24,.9));
      overflow:hidden;
      cursor:pointer;
      min-height: 290px;
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      transition: transform .06s ease, border-color .15s ease, filter .15s ease, box-shadow .2s ease;
      touch-action: manipulation;
    }
    .pick:hover{
      border-color: rgba(124,92,255,.55);
      box-shadow: 0 14px 34px rgba(124,92,255,.18), 0 12px 28px rgba(0,0,0,.35);
      filter: brightness(1.05);
    }
    .pick.picked{
      transform: translateY(-2px) scale(1.01);
      border-color: rgba(34,211,238,.7);
      box-shadow: 0 18px 40px rgba(34,211,238,.22), 0 12px 28px rgba(0,0,0,.35);
    }
    .pick:active{ transform: translateY(1px); }
    .imgbox{
      position:relative;
      width:100%;
      height: 220px;
      background: linear-gradient(135deg, rgba(124,92,255,.22), rgba(36,211,238,.16));
      overflow:hidden;
    }
    .imgbox img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      transform: scale(1.02);
    }
    .fallback{
      width:100%; height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 44px;
      color: rgba(255,255,255,.75);
    }
    .label{
      padding: 12px 12px 14px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .menu-name{
      font-size: 20px;
      margin:0;
      letter-spacing:-.3px;
    }
    .menu-sub{
      margin:0;
      color:var(--muted);
      font-size: 13px;
      line-height:1.35;
    }
    .vs{
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius: 18px;
      border:1px dashed rgba(255,255,255,.2);
      color: rgba(255,255,255,.7);
      font-weight: 700;
      letter-spacing:.8px;
      background: rgba(10,14,24,.6);
      text-shadow: 0 0 12px rgba(124,92,255,.35);
    }
    .progress{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(124,92,255,.95), rgba(34,211,238,.95));
      transition: width .2s ease;
    }

    /* Result */
    .winner{
      display:grid;
      grid-template-columns: 260px 1fr;
      gap: 14px;
      padding: 14px;
      align-items:stretch;
    }
    @media (max-width: 720px){
      .winner{ grid-template-columns: 1fr; }
    }
    .winner .imgbox{ height: 220px; border-radius: 18px; border:1px solid rgba(255,255,255,.10); }
    .winner .imgbox img{ border-radius: 18px; }
    .big{
      font-size: 30px;
      margin: 0 0 8px;
      letter-spacing:-.6px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding: 3px 7px;
      border-radius: 9px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.75);
    }
    .toast{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(20,22,29,.92);
      border: 1px solid rgba(255,255,255,.12);
      padding: 10px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow);
      color: rgba(255,255,255,.88);
      font-size: 13px;
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      max-width: calc(100vw - 24px);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }
    .small-note{
      font-size: 12px;
      color: var(--muted);
      line-height:1.45;
      margin: 10px 0 0;
    }
    @keyframes riseIn{
      from{ opacity:0; transform: translateY(16px); }
      to{ opacity:1; transform: translateY(0); }
    }
    @keyframes winPop{
      0%{ opacity:0; transform: translateY(18px) scale(.98); }
      60%{ opacity:1; transform: translateY(-2px) scale(1.01); }
      100%{ opacity:1; transform: translateY(0) scale(1); }
    }
    @keyframes trophyPulse{
      0%,100%{ box-shadow: 0 0 0 rgba(124,92,255,0), 0 0 0 rgba(34,211,238,0); }
      50%{ box-shadow: 0 0 24px rgba(124,92,255,.35), 0 0 36px rgba(34,211,238,.25); }
    }
    header{
      animation: riseIn .5s ease both;
    }
    .grid > .card{
      animation: riseIn .6s ease both;
    }
    .grid > .card:nth-child(2){
      animation-delay: .08s;
    }
    body.state-result .winner{
      animation: winPop .6s ease both;
    }
    body.state-result #winnerImg{
      animation: trophyPulse 1.6s ease-in-out infinite;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>ë­ë¨¹ì§€</h1>
          <p class="sub">ì˜¤ëŠ˜ì˜ í•œ ë¼ë¥¼ ë½‘ëŠ” ë¨¹ë°© ë°°í‹€! ë” ëŒë¦¬ëŠ” ë©”ë‰´ë¥¼ ê³¨ë¼ ê²°ìŠ¹ê¹Œì§€ ì˜¬ë¼ê°€ì„¸ìš”.</p>
        </div>
      </div>
      <div class="pill" id="envPill">ë¡œë”©â€¦</div>
    </header>

    <div class="grid">
      <!-- LEFT: main -->
      <section class="card" id="mainCard">
        <div class="inner" id="setupView">
          <h2 class="section-title">í† ë„ˆë¨¼íŠ¸ ì„¤ì •</h2>
          <div class="row space">
            <span class="chip">4~128ê°• ì„ íƒ</span>
          </div>

          <div class="range-wrap">
            <div>
              <label class="muted" for="countRange">ì°¸ê°€ ë©”ë‰´ ìˆ˜</label>
              <input id="countRange" type="range" min="4" max="128" step="2" value="16" />
              <div class="row" style="margin-top:8px;">
                <button class="btn ghost" data-quick="4">4ê°•</button>
                <button class="btn ghost" data-quick="6">6ê°•</button>
                <button class="btn ghost" data-quick="8">8ê°•</button>
                <button class="btn ghost" data-quick="12">12ê°•</button>
                <button class="btn ghost" data-quick="16">16ê°•</button>
                <button class="btn ghost" data-quick="24">24ê°•</button>
                <button class="btn ghost" data-quick="32">32ê°•</button>
                <button class="btn ghost" data-quick="48">48ê°•</button>
                <button class="btn ghost" data-quick="64">64ê°•</button>
                <button class="btn ghost" data-quick="96">96ê°•</button>
                <button class="btn ghost" data-quick="128">128ê°•</button>
              </div>
              <p class="hint">
                * ì„ íƒí•œ ì¸ì›ì— ë§ì¶° ë¶€ì „ìŠ¹ì„ ìë™ ë°°ì¹˜í•©ë‹ˆë‹¤.
              </p>
            </div>
          </div>

          <div class="hr"></div>

          <details id="advanced">
            <summary>ê³ ê¸‰ ì„¤ì •: ë©”ë‰´ í›„ë³´ í¸ì§‘(ì„ íƒ)</summary>
            <div class="details-inner">
              <p class="hint" style="margin-top:0;">
                ì¤„ë°”ê¿ˆìœ¼ë¡œ ë©”ë‰´ë¥¼ ì¶”ê°€/ì‚­ì œí•˜ì„¸ìš”. (ì¤‘ë³µ/ë¹ˆ ì¤„ì€ ìë™ ì œê±°)
              </p>
              <textarea id="menuTextarea" spellcheck="false"></textarea>
              <div class="row" style="margin-top:10px;">
                <button class="btn" id="resetMenusBtn">ê¸°ë³¸ ë©”ë‰´ë¡œ ë˜ëŒë¦¬ê¸°</button>
                <span class="chip" id="menuCountChip">í›„ë³´: 0ê°œ</span>
              </div>
              <p class="hint">
                ì´ë¯¸ì§€: ê¸°ë³¸ì€ ì˜¨ë¼ì¸ì—ì„œ â€œë©”ë‰´ëª… foodâ€ë¡œ ìë™ ì‚¬ì§„ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤(ì‹¤ì„œë¹„ìŠ¤ëŠ” ì§ì ‘ ì´ë¯¸ì§€ ì—…ë¡œë“œ ë°©ì‹ìœ¼ë¡œ ë°”ê¾¸ëŠ” ê±¸ ì¶”ì²œ).
              </p>
            </div>
          </details>

          <div class="hr"></div>

          <div class="row space">
            <button class="btn primary" id="startBtn">í† ë„ˆë¨¼íŠ¸ ì‹œì‘</button>
            <button class="btn" id="shuffleStartBtn">í›„ë³´ ì„ê³  ì‹œì‘</button>
          </div>

          <p class="small-note">
            ì§€ë„ ì—°ê²°ì€ ëª¨ë°”ì¼ì—ì„œ ê°€ì¥ ìì—°ìŠ¤ëŸ½ê²Œ ë™ì‘í•©ë‹ˆë‹¤. PCì—ì„œëŠ” â€œì¹´ì¹´ì˜¤ë§µ ì›¹ ê²€ìƒ‰â€ì€ ì •ìƒ ë™ì‘í•˜ì§€ë§Œ,
            ë„¤ì´ë²„ ì§€ë„ ì•± ìŠ¤í‚´ì€ í™˜ê²½ì— ë”°ë¼ ì—´ë¦¬ì§€ ì•Šì„ ìˆ˜ ìˆì–´ìš”.
          </p>
        </div>

        <div class="inner" id="playView" style="display:none;">
          <div class="row space">
            <div class="row">
              <span class="chip" id="roundChip">-</span>
              <span class="chip" id="matchChip">-</span>
            </div>
            <div class="row">
              <button class="btn" id="undoBtn" title="ë˜ëŒë¦¬ê¸° (ê°€ëŠ¥í•œ ê²½ìš°)">ë˜ëŒë¦¬ê¸°</button>
              <button class="btn danger" id="restartBtn">ì²˜ìŒë¶€í„°</button>
            </div>
          </div>

          <div class="hr"></div>

          <div class="progress" aria-label="ì§„í–‰ë¥ ">
            <div class="bar" id="progressBar"></div>
          </div>

          <div class="arena" id="arena">
            <div class="pick" id="pickLeft" role="button" tabindex="0" aria-label="ì™¼ìª½ ë©”ë‰´ ì„ íƒ">
              <div class="imgbox" id="imgLeft">
                <div class="fallback" aria-hidden="true">ğŸ½ï¸</div>
              </div>
              <div class="label">
                <p class="menu-name" id="nameLeft">-</p>
                <p class="menu-sub">ì´ê±¸ë¡œ ê°„ë‹¤</p>
              </div>
            </div>

            <div class="vs">VS</div>

            <div class="pick" id="pickRight" role="button" tabindex="0" aria-label="ì˜¤ë¥¸ìª½ ë©”ë‰´ ì„ íƒ">
              <div class="imgbox" id="imgRight">
                <div class="fallback" aria-hidden="true">ğŸ½ï¸</div>
              </div>
              <div class="label">
                <p class="menu-name" id="nameRight">-</p>
                <p class="menu-sub">ì´ê²Œ ë” ë•¡ê¸´ë‹¤</p>
              </div>
            </div>
          </div>

          <p class="small-note" id="byeNote" style="display:none;">
            ë¶€ì „ìŠ¹(BYE)ì´ ì„ì—¬ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¼ìš´ë“œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.
          </p>
        </div>

        <div class="inner" id="resultView" style="display:none;">
          <h2 class="section-title">ìµœì¢… ì„ íƒ</h2>
          <div class="winner">
            <div class="imgbox" id="winnerImg">
              <div class="fallback" aria-hidden="true">ğŸ†</div>
            </div>
            <div>
              <h3 class="big" id="winnerName">-</h3>
              <p class="sub" id="winnerDesc">ìš°ìŠ¹ ë©”ë‰´ í™•ì •! ì§€ê¸ˆ ë°”ë¡œ ë§›ì§‘ì„ ì°¾ì•„ë³¼ê¹Œìš”?</p>

              <div class="row" style="margin-top:12px;">
                <button class="btn primary" id="naverBtn">ë„¤ì´ë²„ ì§€ë„ ì•±ì—ì„œ ê²€ìƒ‰</button>
                <button class="btn primary" id="kakaoBtn">ì¹´ì¹´ì˜¤ë§µ ì•±ì—ì„œ ê²€ìƒ‰</button>
              </div>

              <div class="row" style="margin-top:10px;">
                <a class="btn ghost" id="kakaoWebLink" href="#" target="_blank" rel="noopener">ì¹´ì¹´ì˜¤ë§µ ì›¹ìœ¼ë¡œ ì—´ê¸°</a>
                <button class="btn" id="copyBtn">ê²°ê³¼ ë³µì‚¬</button>
              </div>

              <p class="small-note">
                * â€œë‚´ ì£¼ë³€â€ ì •í™•ë„ë¥¼ ë†’ì´ë ¤ë©´ ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”. (ì¹´ì¹´ì˜¤ë§µ ì•± ê²€ìƒ‰ì€ ì¢Œí‘œ ì¤‘ì‹¬ ê²€ìƒ‰ì„ ì§€ì›)
              </p>
              <div class="hr"></div>

              <div class="row">
                <button class="btn ok" id="againBtn">ë‹¤ì‹œ í† ë„ˆë¨¼íŠ¸</button>
                <button class="btn" id="backToSetupBtn">ì„¤ì •ìœ¼ë¡œ</button>
              </div>

              <p class="small-note">
                íŒ: <span class="kbd">ë˜ëŒë¦¬ê¸°</span>ë¡œ ì§ì „ ì„ íƒì„ 1ë²ˆ ë˜ëŒë¦´ ìˆ˜ ìˆì–´ìš”.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: info -->
      <aside class="card">
        <div class="inner">
          <h2 class="section-title">ì‚¬ìš© ë°©ë²•</h2>
          <ol class="muted" style="line-height:1.6; margin: 0; padding-left: 18px;">
            <li>ì°¸ê°€ ë©”ë‰´ ìˆ˜ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. (4/6/8/12/16/24/32/48/64/96/128)</li>
            <li>ì‚¬ì§„ 2ê°œ ì¤‘ ë” ë•¡ê¸°ëŠ” ë©”ë‰´ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.</li>
            <li>ìµœì¢… 1ê°œê°€ ë‚¨ì„ ë•Œê¹Œì§€ ë°˜ë³µí•©ë‹ˆë‹¤.</li>
            <li>ìš°ìŠ¹ ë©”ë‰´ë¥¼ ì§€ë„ ì•±ì—ì„œ ë°”ë¡œ ê²€ìƒ‰í•©ë‹ˆë‹¤.</li>
          </ol>
        </div>
      </aside>
    </div>

    <div class="toast" id="toast">-</div>
  </div>

  <script>
    /********************
     * Utility
     ********************/
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => [...document.querySelectorAll(sel)];

    function clampMin(n, min){
      n = Number(n);
      if (Number.isNaN(n)) return min;
      if (n < min) return min;
      return n;
    }
    function shuffle(arr){
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    const ALLOWED_COUNTS = [4,6,8,12,16,24,32,48,64,96,128];
    function snapCount(n){
      const val = Number(n);
      if (Number.isNaN(val)) return ALLOWED_COUNTS[0];
      let best = ALLOWED_COUNTS[0];
      let bestDiff = Math.abs(val - best);
      for (const c of ALLOWED_COUNTS){
        const d = Math.abs(val - c);
        if (d < bestDiff){
          best = c;
          bestDiff = d;
        }
      }
      return best;
    }
    function nextPow2(n){
      let p = 1;
      while (p < n) p <<= 1;
      return p;
    }
    function hash32(str){
      // simple deterministic hash for stable image query variation
      let h = 2166136261;
      for (let i = 0; i < str.length; i++){
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return (h >>> 0);
    }
    const MENU_IMAGES = {
      // ë©”ë‰´ë³„ URL ë§¤í•‘ (ì—†ìœ¼ë©´ ìë™ ì´ë¯¸ì§€ë¡œ fallback)
      // ì˜ˆì‹œ:
      // "ê¹€ì¹˜ì°Œê°œ": "https://example.com/images/kimchi.jpg",
      // "ë¶€ëŒ€ì°Œê°œ": "https://example.com/images/budae.jpg",
    };

    function makeImageUrl(menuName){
      const mapped = MENU_IMAGES[menuName];
      if (mapped) return mapped;
      // fallback: ìë™ ì´ë¯¸ì§€(ì˜¨ë¼ì¸ í•„ìš”)
      const q = encodeURIComponent(menuName + " food");
      const sig = hash32(menuName) % 1000;
      return `https://source.unsplash.com/800x600/?${q}&sig=${sig}`;
    }
    function uniqClean(lines){
      const out = [];
      const seen = new Set();
      for (const raw of lines){
        const s = String(raw).trim();
        if (!s) continue;
        const key = s.toLowerCase();
        if (seen.has(key)) continue;
        seen.add(key);
        out.push(s);
      }
      return out;
    }

    /********************
     * Default menu pool (í•œêµ­ ì‚¬ìš©ì ê¸°ì¤€)
     * - í•„ìš”í•˜ë©´ ê³ ê¸‰ ì„¤ì •ì—ì„œ í¸ì§‘
     ********************/
    const DEFAULT_MENUS = uniqClean([
      "ì‚¼ê²¹ì‚´","ëª©ì‚´","ì†Œê°ˆë¹„","ë¼ì§€ê°ˆë¹„","ì†Œê³ ê¸°","ê³±ì°½","ëŒ€ì°½","ë§‰ì°½","ì–‘ê¼¬ì¹˜","ë‹­ê°ˆë¹„","ë‹­ê°•ì •","ì–‘ë…ì¹˜í‚¨","ê°„ì¥ì¹˜í‚¨","í›„ë¼ì´ë“œì¹˜í‚¨","ë‹­ë˜¥ì§‘","ì¹˜ì¦ˆë‹­ê°ˆë¹„","ì°œë‹­","ë‹­ë³¶ìŒíƒ•",
      "ê¹€ì¹˜ì°Œê°œ","ëœì¥ì°Œê°œ","ìˆœë‘ë¶€ì°Œê°œ","ë¶€ëŒ€ì°Œê°œ","ê°ˆë¹„íƒ•","ì„¤ë íƒ•","ê³°íƒ•","ìœ¡ê°œì¥","ë‹­ê°œì¥","ê°ìíƒ•","í•´ì¥êµ­",
      "êµ­ë°¥","ìˆœëŒ€êµ­","ì½©ë‚˜ë¬¼êµ­ë°¥","ë¹„ë¹”ë°¥","ëŒì†¥ë¹„ë¹”ë°¥","ê¹€ë°¥","ë¼ë©´","ë–¡ë³¶ì´","ë–¡ë³¶ì´(ì—½ê¸° ìŠ¤íƒ€ì¼)","êµ­ë¬¼ë–¡ë³¶ì´","ë¼ë³¶ì´","ì¦‰ì„ë–¡ë³¶ì´","í¬ë¦¼ë–¡ë³¶ì´","íŠ€ê¹€","ìƒˆìš°íŠ€ê¹€","ì–´ë¬µ","ë¶„ì‹",
      "ëƒ‰ë©´","ë¬¼ëƒ‰ë©´","ë¹„ëƒ‰","ë°€ë©´","ì¹¼êµ­ìˆ˜","ìˆ˜ì œë¹„","ìŒ€êµ­ìˆ˜","ìš°ë™","ì†Œë°”","ì§œì¥ë©´","ì§¬ë½•","íƒ•ìˆ˜ìœ¡",
      "ë§ˆë¼íƒ•","ë§ˆë¼ìƒ¹ê¶ˆ","í› ê¶ˆ","ê¹í’ê¸°","ìœ ë¦°ê¸°",
      "ì´ˆë°¥","íšŒ","ì—°ì–´","ì°¸ì¹˜","ëˆë¶€ë¦¬","ë¼ë©˜","ì•¼í‚¤ì†Œë°”","ê°€ì¸ ë™","ê·œë™","ê¹€ì¹˜ë‚˜ë² ëˆê¹ŒìŠ¤","í…ë™","ì˜¤ë‹ˆê¸°ë¦¬","íƒ€ì½”ë¼ì´ìŠ¤","ëˆê¹ŒìŠ¤(ê²½ì–‘ì‹)","ëˆê¹ŒìŠ¤(ì¼ë³¸ì‹)","ìš°ë‚˜ê¸°ë™",
      "í† ë§ˆí† íŒŒìŠ¤íƒ€","ê¹Œë¥´ë³´ë‚˜ë¼","ìŠ¤í…Œì´í¬","ìƒëŸ¬ë“œ","ìƒŒë“œìœ„ì¹˜","ì¹´ì¸ ì‚°ë„","íƒ€ì½”","ë¶€ë¦¬ë˜","í”„ëœì°¨ì´ì¦ˆë²„ê±°","í”¼ì(ì´íƒœë¦¬ì‹)","í”¼ì(ë¯¸êµ­ì‹)",
      "íƒ„ë‘ë¦¬ì¹˜í‚¨","ì¸ë„ì»¤ë¦¬","ì¼ë³¸ì¹´ë ˆ",
      "ì¡±ë°œ","ë³´ìŒˆ","ìˆ˜ìœ¡","ëª¨ë“¬ì „","í•´ë¬¼íŒŒì „","ë¹ˆëŒ€ë–¡","ë–¡êµ­","ë§Œë‘","ë§Œë‘£êµ­",
      "ì˜¤ì§•ì–´ë³¶ìŒ","ë‚™ì§€ë³¶ìŒ","ì£¼ê¾¸ë¯¸ë³¶ìŒ","ì œìœ¡ë³¶ìŒ","ë¶ˆê³ ê¸°","ë‹­ë°œ","ì­ˆê¾¸ë¯¸","ë‚™ê³±ìƒˆ","í•´ë¬¼ì°œ","ì•„êµ¬ì°œ","ì˜¤ì§•ì–´ìˆœëŒ€",
      "ê°„ì¥ê²Œì¥","ì–‘ë…ê²Œì¥","ê½ƒê²Œíƒ•","ìƒˆìš°êµ¬ì´","ì¡°ê°œêµ¬ì´","ì¡°ê°œì°œ","ëŒ€ê²Œ","í‚¹í¬ë©",
      "ì¥ì–´êµ¬ì´","ê³ ë“±ì–´êµ¬ì´","ê°ˆì¹˜ì¡°ë¦¼","ì‚¼ì¹˜êµ¬ì´","ë§¤ìš´íƒ•","ë™íƒœíƒ•","ì•Œíƒ•","ì¶”ì–´íƒ•",
      "ìƒ¤ë¸Œìƒ¤ë¸Œ","ì „ê³¨","ê³±ì°½ì „ê³¨",
      "ë®ë°¥","ì˜¤ë¯€ë¼ì´ìŠ¤","ë³¶ìŒë°¥","ê¹€ì¹˜ë³¶ìŒë°¥","ì˜¤ì¼íŒŒìŠ¤íƒ€",
      "í† ìŠ¤íŠ¸","í•«ë„ê·¸",
      // ì¶”ê°€ í›„ë³´
      "ë°±ë°˜","í•œì •ì‹","(í•œì†¥)ë„ì‹œë½","ìŒˆë°¥","ë‘ë£¨ì¹˜ê¸°","ë¹„ë¹”êµ­ìˆ˜","ì”ì¹˜êµ­ìˆ˜","ì½©êµ­ìˆ˜",
      "ë‹­í•œë§ˆë¦¬","ìˆ˜ì œë²„ê±°","ë¡œì œë–¡ë³¶ì´","ì¹˜ì¦ˆëˆê¹ŒìŠ¤","ì¹´ë ˆìš°ë™","ë¹„ë¹”ë°¥","ëŒì†¥ë¹„ë¹•ë°¥",
      "í•´ë¬¼ì§¬ë½•","ë‚˜ê°€ì‚¬í‚¤ì§¬ë½•","íƒ„íƒ„ë©´","ë³¶ìŒë©´","ë”¤ì„¬","ë¶ê²½ì˜¤ë¦¬",
      "ë² íŠ¸ë‚¨ë¶„ì§œ","ë°˜ë¯¸","íŒŸíƒ€ì´","ë˜ ì–Œê¿","ë‚˜ì‹œê³ ë ",
      "í…ì‚¬ìŠ¤ë°”ë² í",
      "í¬ë¦¼íŒŒìŠ¤íƒ€","ë¡œì œíŒŒìŠ¤íƒ€","ìˆ˜í”„ì¹´ë ˆ",
      "ë¶€ë¦¬ë˜ë³¼","í¬ì¼€",
      "ê³ ê¸°êµ­ìˆ˜","ë¼ì§€êµ­ë°¥","ë°€í‘€ìœ ë‚˜ë² ",
      "ë¦¬ì¡°ë˜","ì˜¤ì½”ë…¸ë¯¸ì•¼í‚¤",
      "ë¼ìëƒ","ë¯¸íŠ¸ë³¼",
      "ë–¡ê°ˆë¹„","ê³ ì¶”ì¥ë¶ˆê³ ê¸°","ì°¨ëŒë°•ì´",
      "íšŒë®ë°¥","ë¬¼íšŒ",
      "ì§œê¸€ì´","ì²­êµ­ì¥","ë™íƒœì°Œê°œ",
      "í¸ì˜ì "
    ]);

    /********************
     * State
     ********************/
    let pool = DEFAULT_MENUS.slice(); // string[]
    let selectedCount = 16;

    // tournament state
    let bracketSize = 16;
    let byes = 0;

    let current = [];   // {name, img, bye?}[]
    let next = [];
    let matchIndex = 0; // which pair
    let totalMatchesThisRound = 0;

    // history for undo
    let history = [];

    // winner
    let winner = null; // {name,img}

    /********************
     * DOM refs
     ********************/
    const envPill = $("#envPill");

    const setupView = $("#setupView");
    const playView = $("#playView");
    const resultView = $("#resultView");

    const countRange = $("#countRange");
    const startBtn = $("#startBtn");
    const shuffleStartBtn = $("#shuffleStartBtn");

    const menuTextarea = $("#menuTextarea");
    const resetMenusBtn = $("#resetMenusBtn");
    const menuCountChip = $("#menuCountChip");

    const roundChip = $("#roundChip");
    const matchChip = $("#matchChip");
    const progressBar = $("#progressBar");

    const pickLeft = $("#pickLeft");
    const pickRight = $("#pickRight");
    const nameLeft = $("#nameLeft");
    const nameRight = $("#nameRight");
    const imgLeft = $("#imgLeft");
    const imgRight = $("#imgRight");
    const byeNote = $("#byeNote");

    const undoBtn = $("#undoBtn");
    const restartBtn = $("#restartBtn");

    const winnerName = $("#winnerName");
    const winnerImg = $("#winnerImg");
    const winnerDesc = $("#winnerDesc");
    const naverBtn = $("#naverBtn");
    const kakaoBtn = $("#kakaoBtn");
    const kakaoWebLink = $("#kakaoWebLink");
    const copyBtn = $("#copyBtn");
    const againBtn = $("#againBtn");
    const backToSetupBtn = $("#backToSetupBtn");

    const toast = $("#toast");

    /********************
     * Environment badge
     ********************/
    function getEnvText(){
      const ua = navigator.userAgent || "";
      const isAndroid = /Android/i.test(ua);
      const isIOS = /iPhone|iPad|iPod/i.test(ua);
      const isMobile = isAndroid || isIOS || /Mobile/i.test(ua);
      const https = location.protocol === "https:";
      const geo = !!navigator.geolocation;
      let platform = "PC";
      if (isAndroid) platform = "Android";
      else if (isIOS) platform = "iOS";
      else if (isMobile) platform = "Mobile";
      return `${platform} Â· ${https ? "HTTPS" : "HTTP"} Â· ìœ„ì¹˜ê¶Œí•œ ${geo ? "ê°€ëŠ¥" : "ë¶ˆê°€"}`;
    }

    /********************
     * Toast
     ********************/
    let toastTimer = null;
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.remove("show"), 1400);
    }

    /********************
     * Pool editing
     ********************/
    function syncPoolFromTextarea(){
      const lines = menuTextarea.value.split(/\r?\n/);
      pool = uniqClean(lines);
      menuCountChip.textContent = `í›„ë³´: ${pool.length}ê°œ`;
    }
    function loadDefaultPool(){
      pool = DEFAULT_MENUS.slice();
      menuTextarea.value = pool.join("\n");
      menuCountChip.textContent = `í›„ë³´: ${pool.length}ê°œ`;
    }

    /********************
     * Bracket preparation (NO bye-vs-bye)
     ********************/
    function pickCandidates(count){
      if (pool.length < count){
        // í›„ë³´ ë¶€ì¡±í•˜ë©´ poolì„ ì„ì–´ì„œ ì¤‘ë³µ ì—†ì´ ê°€ëŠ¥í•œ ë§Œí¼ë§Œ.
        // (ì‹¤ì„œë¹„ìŠ¤ë¼ë©´ ì´ ê²½ìš° ì…ë ¥ì„ ë” ë°›ëŠ” ê²Œ ì¢‹ìŒ)
        showToast(`í›„ë³´ê°€ ${pool.length}ê°œë¼ì„œ ê°€ëŠ¥í•œ ë§Œí¼ë§Œ ì§„í–‰í•©ë‹ˆë‹¤.`);
        count = pool.length;
      }
      const chosen = shuffle(pool).slice(0, count);
      return chosen.map(name => ({
        name,
        img: makeImageUrl(name),
        bye: false
      }));
    }

    function makeInitialBracket(count){
      const menus = pickCandidates(count);
      const actualCount = menus.length;
      bracketSize = nextPow2(actualCount);
      byes = bracketSize - actualCount;
      const slots = new Array(bracketSize).fill(null);

      // choose random pairs to place byes: ensures no bye-bye
      const pairCount = bracketSize / 2;
      const pairIdxs = shuffle([...Array(pairCount)].map((_,i)=>i)).slice(0, byes);

      for (const p of pairIdxs){
        const pos = 2*p + (Math.random() < 0.5 ? 0 : 1);
        slots[pos] = { name:"BYE", img:"", bye:true };
      }

      // fill remaining slots with shuffled menus
      const shuffledMenus = shuffle(menus);
      let mi = 0;
      for (let i = 0; i < slots.length; i++){
        if (slots[i] === null){
          slots[i] = shuffledMenus[mi++];
        }
      }
      return slots;
    }

    /********************
     * Tournament rendering
     ********************/
    function stageLabel(n){
      // n is current candidates length (power of 2)
      if (n <= 1) return "ê²°ìŠ¹";
      return `${n}ê°•`;
    }

    function updateTopInfo(){
      roundChip.textContent = `${stageLabel(current.length)} ì§„í–‰ ì¤‘`;
      matchChip.textContent = `${matchIndex+1} / ${totalMatchesThisRound} ê²½ê¸°`;
      const done = Math.min(matchIndex, totalMatchesThisRound);
      const pct = totalMatchesThisRound ? (done / totalMatchesThisRound) * 100 : 0;
      progressBar.style.width = `${pct}%`;

      undoBtn.disabled = history.length === 0;
    }

    function setImg(el, url){
      el.innerHTML = ""; // clear
      const img = document.createElement("img");
      img.alt = "";
      img.loading = "eager";
      img.decoding = "async";
      img.referrerPolicy = "no-referrer";
      img.src = url;
      img.onerror = () => {
        el.innerHTML = `<div class="fallback" aria-hidden="true">ğŸ½ï¸</div>`;
      };
      el.appendChild(img);
    }

    function renderCurrentMatch(){
      pickLeft.classList.remove("picked");
      pickRight.classList.remove("picked");
      // auto-resolve BYE matches
      while (true){
        const left = current[2*matchIndex];
        const right = current[2*matchIndex + 1];

        if (!left || !right) break;

        if (left.bye && right.bye){
          // shouldn't happen due to placement, but safe-guard
          matchIndex++;
          continue;
        } else if (left.bye && !right.bye){
          next.push(right);
          matchIndex++;
          continue;
        } else if (!left.bye && right.bye){
          next.push(left);
          matchIndex++;
          continue;
        }
        break;
      }

      if (matchIndex >= totalMatchesThisRound){
        // round finished
        if (next.length === 1){
          winner = next[0];
          showResult();
          return;
        }
        // go next round
        history = []; // undoëŠ” ë¼ìš´ë“œ ë‹¨ìœ„ê°€ ë°”ë€Œë©´ ì´ˆê¸°í™”(ê°„ë‹¨ MVP)
        current = next;
        next = [];
        matchIndex = 0;
        totalMatchesThisRound = current.length / 2;
        updateTopInfo();
        renderCurrentMatch();
        return;
      }

      const left = current[2*matchIndex];
      const right = current[2*matchIndex + 1];

      nameLeft.textContent = left.name;
      nameRight.textContent = right.name;

      setImg(imgLeft, left.img);
      setImg(imgRight, right.img);

      byeNote.style.display = (byes > 0) ? "block" : "none";

      updateTopInfo();
    }

    function choose(side){
      const left = current[2*matchIndex];
      const right = current[2*matchIndex + 1];
      const picked = (side === "L") ? left : right;
      const pickedEl = (side === "L") ? pickLeft : pickRight;

      // save snapshot for undo (minimal)
      history.push({
        current: current.slice(),
        next: next.slice(),
        matchIndex
      });

      pickedEl.classList.add("picked");
      setTimeout(() => pickedEl.classList.remove("picked"), 220);

      next.push(picked);
      matchIndex++;
      renderCurrentMatch();
    }

    function undo(){
      const snap = history.pop();
      if (!snap) return;
      current = snap.current;
      next = snap.next;
      matchIndex = snap.matchIndex;
      renderCurrentMatch();
      showToast("ì§ì „ ì„ íƒì„ ë˜ëŒë ¸ì–´ìš”");
    }

    /********************
     * Views
     ********************/
    function showSetup(){
      document.body.classList.remove("state-play","state-result");
      setupView.style.display = "";
      playView.style.display = "none";
      resultView.style.display = "none";
    }
    function showPlay(){
      document.body.classList.add("state-play");
      document.body.classList.remove("state-result");
      setupView.style.display = "none";
      playView.style.display = "";
      resultView.style.display = "none";
    }
    function showResult(){
      document.body.classList.add("state-result");
      document.body.classList.remove("state-play");
      setupView.style.display = "none";
      playView.style.display = "none";
      resultView.style.display = "";

      winnerName.textContent = winner?.name ?? "-";
      winnerDesc.textContent = `WIN! â€œ${winner?.name ?? ""}â€ ë¨¹ìœ¼ëŸ¬ ê°€ì!`;

      winnerImg.innerHTML = "";
      if (winner?.img){
        const img = document.createElement("img");
        img.alt = "";
        img.loading = "eager";
        img.decoding = "async";
        img.referrerPolicy = "no-referrer";
        img.src = winner.img;
        img.onerror = () => winnerImg.innerHTML = `<div class="fallback" aria-hidden="true">ğŸ†</div>`;
        winnerImg.appendChild(img);
      } else {
        winnerImg.innerHTML = `<div class="fallback" aria-hidden="true">ğŸ†</div>`;
      }

      // Kakao web link works on desktop too
      const q = encodeURIComponent(`${winner.name} ë§›ì§‘`);
      kakaoWebLink.href = `https://map.kakao.com/link/search/${q}`;

      showToast("ìš°ìŠ¹ ë©”ë‰´ê°€ ê²°ì •ëì–´ìš”!");
    }

    /********************
     * Map deep links
     * - NAVER: nmap://search?query=...&appname=... (appname required)
     * - NAVER Android Web fallback: intent://...#Intent;scheme=nmap;...;package=com.nhn.android.nmap;end
     * - Kakao: kakaomap://search?q=...&p=lat,lng
     * - Kakao web: https://map.kakao.com/link/search/ê²€ìƒ‰ì–´
     ********************/
    function isAndroid(){
      return /Android/i.test(navigator.userAgent || "");
    }
    function isIOS(){
      return /iPhone|iPad|iPod/i.test(navigator.userAgent || "");
    }
    function isMobile(){
      return isAndroid() || isIOS() || /Mobile/i.test(navigator.userAgent || "");
    }

    function getAppName(){
      // naver doc: ì›¹ í˜ì´ì§€ëŠ” ì›¹ í˜ì´ì§€ URLì„ appnameìœ¼ë¡œ ì‚¬ìš©
      // ë„ˆë¬´ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆì–´ origin ì •ë„ë§Œ ì‚¬ìš©
      return location.origin;
    }

    function openNaverMapSearch(query){
      const q = encodeURIComponent(query);
      const appname = encodeURIComponent(getAppName());

      const scheme = `nmap://search?query=${q}&appname=${appname}`;

      if (isAndroid()){
        // Android mobile web: intent URL (app ë¯¸ì„¤ì¹˜ ì‹œ Playë¡œ)
        const intent = `intent://search?query=${q}&appname=${appname}` +
                       `#Intent;scheme=nmap;action=android.intent.action.VIEW;category=android.intent.category.BROWSABLE;package=com.nhn.android.nmap;end`;
        location.href = intent;
      } else {
        // iOS / others
        // iOS mobile webì—ì„œëŠ” íƒ€ì´ë¨¸ë¡œ ì•±ìŠ¤í† ì–´ ë¶„ê¸°í•˜ëŠ” ë°©ì‹ì´ ë¬¸ì„œì— ìˆìœ¼ë‚˜,
        // UXë¥¼ ìœ„í•´ ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœíˆ ìŠ¤í‚´ë§Œ í˜¸ì¶œí•˜ê³ , ì„¤ì¹˜ ì•ˆë‚´ëŠ” ë³„ë„ë¡œ í•˜ì§€ ì•ŠìŒ.
        location.href = scheme;
      }
    }

    function requestGeo(){
      return new Promise((resolve) => {
        if (!navigator.geolocation){
          resolve(null);
          return;
        }
        navigator.geolocation.getCurrentPosition(
          (pos) => resolve({ lat: pos.coords.latitude, lng: pos.coords.longitude }),
          () => resolve(null),
          { enableHighAccuracy:false, timeout: 4000, maximumAge: 60000 }
        );
      });
    }

    async function openKakaoMapSearch(query){
      const geo = await requestGeo();

      const q = encodeURIComponent(query);
      if (geo){
        const p = `${geo.lat},${geo.lng}`;
        // App scheme
        const appUrl = `kakaomap://search?q=${q}&p=${p}`;
        // Mobile web scheme (works if app not installed too)
        const webScheme = `http://m.map.kakao.com/scheme/search?q=${q}&p=${p}`;

        // Try app scheme first on mobile; otherwise open web scheme
        if (isMobile()){
          location.href = appUrl;
          // If the app scheme is blocked, user can still click "ì¹´ì¹´ì˜¤ë§µ ì›¹ìœ¼ë¡œ" ë²„íŠ¼.
          showToast("ì¹´ì¹´ì˜¤ë§µì„ ì—¬ëŠ” ì¤‘â€¦");
        } else {
          window.open(`https://map.kakao.com/link/search/${q}`, "_blank", "noopener");
        }
      } else {
        // no geo: open web search
        window.open(`https://map.kakao.com/link/search/${q}`, "_blank", "noopener");
      }
    }

    /********************
     * Start / restart
     ********************/
    function startTournament({shuffleFirst=false} = {}){
      syncPoolFromTextarea();

      // selectedCount is from inputs (snap to allowed list)
      selectedCount = snapCount(countRange.value);

      if (pool.length < 4){
        showToast("ë©”ë‰´ í›„ë³´ê°€ ë„ˆë¬´ ì ì–´ìš”(ìµœì†Œ 4ê°œ).");
        return;
      }

      if (shuffleFirst){
        pool = shuffle(pool);
        menuTextarea.value = pool.join("\n");
      }

      current = makeInitialBracket(selectedCount);
      next = [];
      matchIndex = 0;
      history = [];

      totalMatchesThisRound = current.length / 2;

      showPlay();
      updateTopInfo();
      renderCurrentMatch();
    }

    function resetAll(){
      winner = null;
      current = [];
      next = [];
      matchIndex = 0;
      history = [];
      byes = 0;
      bracketSize = selectedCount;
      showSetup();
    }

    /********************
     * Events
     ********************/
    function syncCountUI(val, {fromInput=false} = {}){
      const n = snapCount(val);
      selectedCount = n;
      countRange.value = String(n);
    }

    countRange.addEventListener("input", (e)=> syncCountUI(e.target.value));

    $$(".btn[data-quick]").forEach(btn => {
      btn.addEventListener("click", () => syncCountUI(btn.dataset.quick));
    });

    startBtn.addEventListener("click", () => startTournament({shuffleFirst:false}));
    shuffleStartBtn.addEventListener("click", () => startTournament({shuffleFirst:true}));

    resetMenusBtn.addEventListener("click", () => {
      loadDefaultPool();
      showToast("ê¸°ë³¸ ë©”ë‰´ë¡œ ë˜ëŒë ¸ì–´ìš”");
    });

    menuTextarea.addEventListener("input", () => syncPoolFromTextarea());

    pickLeft.addEventListener("click", () => choose("L"));
    pickRight.addEventListener("click", () => choose("R"));

    // keyboard accessibility
    pickLeft.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); choose("L"); }});
    pickRight.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); choose("R"); }});

    undoBtn.addEventListener("click", undo);
    restartBtn.addEventListener("click", () => {
      showToast("ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤");
      resetAll();
    });

    naverBtn.addEventListener("click", () => {
      if (!winner) return;
      // "ë‚´ ì£¼ë³€" ë‰˜ì•™ìŠ¤ë¥¼ ìœ„í•´ 'ë§›ì§‘' í¬í•¨ (ë„¤ì´ë²„ëŠ” query ê¸°ë°˜ ê²€ìƒ‰)
      openNaverMapSearch(`${winner.name} ë§›ì§‘`);
    });

    kakaoBtn.addEventListener("click", async () => {
      if (!winner) return;
      await openKakaoMapSearch(`${winner.name} ë§›ì§‘`);
    });

    copyBtn.addEventListener("click", async () => {
      if (!winner) return;
      const text = `ì˜¤ëŠ˜ ë©”ë‰´: ${winner.name}`;
      try{
        await navigator.clipboard.writeText(text);
        showToast("í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆì–´ìš”");
      }catch{
        showToast("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”");
      }
    });

    againBtn.addEventListener("click", () => startTournament({shuffleFirst:true}));
    backToSetupBtn.addEventListener("click", resetAll);

    /********************
     * Init
     ********************/
    envPill.textContent = getEnvText();
    loadDefaultPool();
    syncCountUI(16);
  </script>
</body>
</html>
